name: matrix

on:
  push:
    branches:
      - master
  schedule:
    - cron: "0 3 * * 5"

env:
  ACE_ROOT: '/usr/share/ace'
  TAO_ROOT: '/usr/share/tao'
  DDS_ROOT: '/usr/share/dds'

jobs:
  matrix:
    runs-on: ubuntu-18.04

    env: ${{matrix.env}}

    steps:
    - uses: actions/checkout@v2

    - name: Get NDK
      run: |
        bash get_ndk.sh
        bash mk_toolchain.sh

    - name: Get OpenDDS and Dependencies
      run: |
        bash get_ace_tao.sh
        bash get_opendds.sh
        if ${use_security:-false}; then bash get_xerces.sh; fi
        if ${use_security:-false}; then bash get_openssl.sh; fi

    - name: Build
      run: |
        bash configure.sh
        bash build.sh

    strategy:
      fail-fast: false
      matrix:
# BEGIN MATRIX
# This part is generated by matrix.py
# r21d ========================================
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 29
            - use_security: true
            - use_java: true
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 28
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 27
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 26
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 24
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 23
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 22
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 21
        include:
          env:
            - arch: arm
            - ndk: r21d
            - api: 19
        include:
          env:
            - arch: arm
            - ndk: r21d
            - api: 18
        include:
          env:
            - arch: arm
            - ndk: r21d
            - api: 17
        include:
          env:
            - arch: arm
            - ndk: r21d
            - api: 16
            - use_security: true
            - use_java: true
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 29
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 28
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 27
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 26
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 24
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 23
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 22
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm64
            - ndk: r21d
            - api: 21
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm
            - ndk: r21d
            - api: 19
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm
            - ndk: r21d
            - api: 18
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm
            - ndk: r21d
            - api: 17
            - use_oci_ace_tao: true
        include:
          env:
            - arch: arm
            - ndk: r21d
            - api: 16
            - use_oci_ace_tao: true
# r20b ========================================
        include:
          env:
            - arch: arm64
            - ndk: r20b
            - api: 29
        include:
          env:
            - arch: arm64
            - ndk: r20b
            - api: 28
        include:
          env:
            - arch: arm
            - ndk: r20b
            - api: 16
# r19c ========================================
        include:
          env:
            - arch: arm64
            - ndk: r19c
            - api: 28
        include:
          env:
            - arch: arm
            - ndk: r19c
            - api: 16
# r18b ========================================
        include:
          env:
            - arch: arm64
            - ndk: r18b
            - api: 28
        include:
          env:
            - arch: arm
            - ndk: r18b
            - api: 16
# r17c ========================================
        include:
          env:
            - arch: arm64
            - ndk: r17c
            - api: 28
        include:
          env:
            - arch: arm64
            - ndk: r17c
            - api: 27
        include:
          env:
            - arch: arm64
            - ndk: r17c
            - api: 26
        include:
          env:
            - arch: arm
            - ndk: r17c
            - api: 16
# r15c ========================================
        include:
          env:
            - arch: arm64
            - ndk: r15c
            - api: 26
        include:
          env:
            - arch: arm64
            - ndk: r15c
            - api: 24
        include:
          env:
            - arch: arm
            - ndk: r15c
            - api: 16
# r14b ========================================
        include:
          env:
            - arch: arm64
            - ndk: r14b
            - api: 24
        include:
          env:
            - arch: arm
            - ndk: r14b
            - api: 16
# r12b ========================================
        include:
          env:
            - arch: arm64
            - ndk: r12b
            - api: 24
        include:
          env:
            - arch: arm64
            - ndk: r12b
            - api: 21
        include:
          env:
            - arch: arm
            - ndk: r12b
            - api: 16
# END MATRIX
